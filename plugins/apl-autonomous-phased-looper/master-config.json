{
  "$schema": "https://raw.githubusercontent.com/twofoldtech-dakota/apl/main/schemas/master-config.schema.json",
  "version": "1.0.0",
  "name": "APL Master Configuration",
  "description": "Central control hub for the Autonomous Phased Looper workflow",

  "workflow": {
    "phases": ["plan", "execute", "review"],
    "default_entry_phase": "plan",
    "allow_phase_skip": false,
    "require_review_before_complete": true
  },

  "execution": {
    "max_iterations": 20,
    "max_phase_iterations": 5,
    "max_retry_attempts": 3,
    "timeout_minutes": 30,
    "checkpoint_on_phase_change": true,
    "auto_rollback_on_failure": false
  },

  "parallel_execution": {
    "enabled": true,
    "max_concurrent_agents": 3,
    "min_tasks_for_parallel": 2,
    "conflict_resolution": "sequential_fallback"
  },

  "agents": {
    "orchestrator": {
      "file": "agents/apl-orchestrator.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash", "Task", "TodoWrite"],
      "role": "coordinator",
      "description": "Main coordinator - drives Plan → Execute → Review cycle"
    },
    "planner": {
      "file": "agents/planner-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Glob", "Grep"],
      "role": "planning",
      "description": "Task decomposition with Tree-of-Thoughts reasoning"
    },
    "coder": {
      "file": "agents/coder-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "execution",
      "description": "Code generation using ReAct pattern"
    },
    "tester": {
      "file": "agents/tester-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Glob", "Grep", "Bash"],
      "role": "verification",
      "description": "Test execution and failure analysis"
    },
    "reviewer": {
      "file": "agents/reviewer-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Glob", "Grep"],
      "role": "quality",
      "description": "Reflexion-based code review"
    },
    "learner": {
      "file": "agents/learner-agent.md",
      "enabled": true,
      "model": "haiku",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep"],
      "role": "learning",
      "description": "Knowledge extraction and pattern persistence"
    },
    "meta_orchestrator": {
      "file": "agents/meta-orchestrator.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Task", "TodoWrite"],
      "role": "enterprise",
      "description": "Epic/Feature/Story hierarchy for large projects"
    },
    "requirements_analyst": {
      "file": "agents/requirements-analyst.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Glob", "Grep"],
      "role": "analysis",
      "description": "Domain-specific expert requirements gathering"
    },
    "content_strategy": {
      "file": "agents/content-strategy-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep"],
      "role": "horizontal",
      "category": "content",
      "auto_fix": true,
      "description": "SEO-optimized content evaluation and generation"
    },
    "brand_voice": {
      "file": "agents/brand-voice-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep"],
      "role": "horizontal",
      "category": "content",
      "auto_fix": true,
      "description": "Tone, style guidelines, and terminology consistency"
    },
    "design": {
      "file": "agents/design-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Glob", "Grep"],
      "role": "horizontal",
      "category": "ui",
      "auto_fix": false,
      "description": "UI/UX patterns, design tokens, and component specifications"
    },
    "accessibility": {
      "file": "agents/accessibility-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "horizontal",
      "category": "quality",
      "auto_fix": true,
      "description": "WCAG compliance and accessibility testing"
    },
    "deployer": {
      "file": "agents/deployer-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Glob", "Grep", "Bash"],
      "role": "deployment",
      "description": "Vercel deployment through MCP integration"
    },
    "architecture": {
      "file": "agents/architecture-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep"],
      "role": "enterprise",
      "category": "governance",
      "description": "Architecture Decision Records and governance"
    },
    "infrastructure": {
      "file": "agents/infrastructure-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "enterprise",
      "category": "devops",
      "description": "Infrastructure-as-Code generation (Terraform, K8s, Docker)"
    },
    "security": {
      "file": "agents/security-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "enterprise",
      "category": "security",
      "auto_fix": true,
      "description": "Security scanning, SAST, SCA, and vulnerability remediation"
    },
    "observability": {
      "file": "agents/observability-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "enterprise",
      "category": "devops",
      "auto_fix": true,
      "description": "Monitoring, logging, tracing, and alerting setup"
    },
    "api_evolution": {
      "file": "agents/api-evolution-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "enterprise",
      "category": "integration",
      "description": "API versioning, contracts, and backward compatibility"
    },
    "cicd": {
      "file": "agents/cicd-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "enterprise",
      "category": "devops",
      "auto_fix": true,
      "description": "CI/CD pipeline generation (GitHub Actions, GitLab CI)"
    },
    "database_migration": {
      "file": "agents/database-migration-agent.md",
      "enabled": true,
      "model": "sonnet",
      "tools": ["Read", "Write", "Edit", "Glob", "Grep", "Bash"],
      "role": "enterprise",
      "category": "data",
      "description": "Database schema migrations and evolution"
    },
    "horizontal_coordinator": {
      "file": "agents/horizontal-coordinator.md",
      "enabled": true,
      "model": "haiku",
      "tools": ["Read", "Glob", "Grep", "Task"],
      "role": "utility",
      "description": "Coordinates horizontal agent invocation and aggregates results"
    }
  },

  "horizontal_agents": {
    "enabled": true,
    "invoke_strategy": "auto",
    "guidelines_path": ".apl/guidelines/",
    "file_triggers": {
      "content_strategy": {
        "patterns": ["*.md", "*.mdx", "src/pages/**", "src/content/**", "docs/**"],
        "on_phases": ["execute", "review"]
      },
      "brand_voice": {
        "patterns": ["*.md", "*.mdx", "src/pages/**", "src/content/**", "docs/**"],
        "on_phases": ["review"]
      },
      "design": {
        "patterns": ["*.tsx", "*.jsx", "*.vue", "*.svelte", "src/components/**", "src/pages/**"],
        "on_phases": ["execute", "review"]
      },
      "accessibility": {
        "patterns": ["*.tsx", "*.jsx", "*.vue", "*.svelte", "*.html", "src/components/**", "src/pages/**"],
        "on_phases": ["review"]
      }
    },
    "quality_gates": {
      "block_on_critical": true,
      "min_scores": {
        "seo": 70,
        "voice": 80,
        "design": 75,
        "accessibility": 90
      }
    }
  },

  "hooks": {
    "on_code_change": {
      "enabled": true,
      "trigger": "PostToolUse:Write|Edit",
      "action": "scripts/validate-code.sh",
      "timeout_seconds": 30,
      "fail_on_error": true
    },
    "pre_test": {
      "enabled": true,
      "trigger": "PreTest",
      "action": "scripts/pre-test-setup.sh",
      "timeout_seconds": 60,
      "fail_on_error": false,
      "description": "Setup test environment (database, mocks, fixtures)"
    },
    "post_test": {
      "enabled": true,
      "trigger": "PostTest",
      "action": "scripts/post-test-coverage.sh",
      "timeout_seconds": 30,
      "fail_on_error": true,
      "description": "Enforce coverage gates and generate reports"
    },
    "on_test_failure": {
      "enabled": true,
      "trigger": "TestFailure",
      "action": "scripts/analyze-test-failure.sh",
      "timeout_seconds": 30,
      "fail_on_error": false,
      "description": "Analyze failures and suggest fixes"
    },
    "pre_task_complete": {
      "enabled": true,
      "trigger": "PreTaskComplete",
      "action": "scripts/verify-tests-pass.sh",
      "timeout_seconds": 120,
      "fail_on_error": true,
      "description": "Ensure all tests pass before marking task complete"
    },
    "on_session_end": {
      "enabled": true,
      "trigger": "Stop",
      "action": "scripts/update-learnings.sh",
      "timeout_seconds": 60,
      "fail_on_error": false
    },
    "on_orchestrator_complete": {
      "enabled": true,
      "trigger": "SubagentStop:apl-orchestrator",
      "action": "scripts/track-progress.sh",
      "timeout_seconds": 10,
      "fail_on_error": false
    }
  },

  "confidence": {
    "threshold": "medium",
    "levels": {
      "low": {
        "description": "Uncertain - needs clarification",
        "action": "escalate_to_user"
      },
      "medium": {
        "description": "Reasonably confident - proceed with verification",
        "action": "proceed_with_verification"
      },
      "high": {
        "description": "Very confident - auto-proceed",
        "action": "auto_proceed"
      }
    },
    "escalate_on_low": true,
    "auto_proceed_on_high": true
  },

  "verification": {
    "chain_of_verification": true,
    "run_tests_after_changes": true,
    "run_linter_after_changes": true,
    "require_all_criteria_met": true,
    "test_commands": {
      "default": "npm test",
      "python": "pytest",
      "go": "go test ./...",
      "rust": "cargo test"
    },
    "lint_commands": {
      "default": "npm run lint",
      "python": "ruff check .",
      "go": "golangci-lint run",
      "rust": "cargo clippy"
    },
    "coverage_gates": {
      "enabled": true,
      "min_statements": 80,
      "min_branches": 75,
      "min_functions": 80,
      "min_lines": 80,
      "block_on_decrease": true,
      "coverage_commands": {
        "default": "npm test -- --coverage --coverageReporters=json-summary",
        "python": "pytest --cov --cov-report=json",
        "go": "go test -coverprofile=coverage.out ./...",
        "rust": "cargo tarpaulin --out Json"
      }
    },
    "test_enforcement": {
      "require_tests_for_new_code": true,
      "require_tests_pass_before_task_complete": true,
      "run_regression_tests": true,
      "max_test_retries_for_flaky": 3,
      "fail_fast": false,
      "test_timeout_seconds": 300,
      "parallel_test_execution": true
    },
    "test_generation": {
      "auto_suggest_missing_tests": true,
      "generate_tests_for_untested_functions": true,
      "test_patterns": {
        "unit": "**/*.test.{ts,js,tsx,jsx}",
        "integration": "**/*.integration.test.{ts,js}",
        "e2e": "**/*.e2e.test.{ts,js}"
      }
    }
  },

  "learning": {
    "enabled": true,
    "storage_path": ".apl/learnings.json",
    "persist_success_patterns": true,
    "persist_anti_patterns": true,
    "learn_user_preferences": true,
    "learn_project_knowledge": true,
    "track_technique_stats": true,
    "max_patterns_stored": 100,
    "pattern_decay_days": 90,
    "techniques": {
      "react": { "enabled": true, "weight": 1.0 },
      "chain_of_verification": { "enabled": true, "weight": 1.0 },
      "tree_of_thoughts": { "enabled": true, "weight": 1.0 },
      "reflexion": { "enabled": true, "weight": 1.0 }
    }
  },

  "patterns": {
    "library_path": "patterns/",
    "categories": [
      "authentication",
      "api",
      "database",
      "testing",
      "react",
      "content",
      "enterprise/microservices",
      "enterprise/event-driven",
      "enterprise/cqrs"
    ],
    "auto_suggest": true,
    "min_confidence_to_apply": 0.7
  },

  "enterprise_agents": {
    "enabled": true,
    "invoke_strategy": "goal_based",
    "triggers": {
      "architecture": {
        "keywords": ["architecture", "design decision", "ADR", "tech stack", "pattern choice"],
        "on_phases": ["plan"]
      },
      "infrastructure": {
        "keywords": ["terraform", "kubernetes", "docker", "infrastructure", "cloud", "deploy", "k8s", "aws", "gcp", "azure"],
        "on_phases": ["plan", "execute"]
      },
      "security": {
        "keywords": ["security", "vulnerability", "audit", "penetration", "OWASP", "CVE", "authentication", "authorization"],
        "on_phases": ["review"],
        "auto_run": true
      },
      "observability": {
        "keywords": ["monitoring", "logging", "tracing", "metrics", "alerting", "prometheus", "grafana", "datadog"],
        "on_phases": ["execute"]
      },
      "api_evolution": {
        "keywords": ["API", "versioning", "contract", "OpenAPI", "swagger", "breaking change", "deprecation"],
        "on_phases": ["plan", "review"]
      },
      "cicd": {
        "keywords": ["CI/CD", "pipeline", "github actions", "gitlab", "jenkins", "deployment", "continuous"],
        "on_phases": ["execute"]
      },
      "database_migration": {
        "keywords": ["migration", "schema", "database", "alter table", "prisma", "drizzle", "flyway"],
        "on_phases": ["execute"]
      }
    },
    "quality_gates": {
      "security_scan_required": true,
      "min_security_score": 80,
      "block_on_critical_vulnerabilities": true
    }
  },

  "content_strategy": {
    "enabled": true,
    "default_accessibility_level": "WCAG_AA",
    "seo": {
      "keyword_density_target": 0.02,
      "meta_description_max_length": 160,
      "title_max_length": 60,
      "include_structured_data": true,
      "structured_data_types": ["Article", "FAQPage", "HowTo", "Product"]
    },
    "brand_voice": {
      "tone": "professional",
      "personality_traits": ["helpful", "knowledgeable", "approachable"],
      "vocabulary_level": "moderate",
      "avoid_words": [],
      "preferred_phrases": []
    },
    "ai_citation_optimization": {
      "enabled": true,
      "include_definitive_statements": true,
      "include_authoritative_references": true
    }
  },

  "context_management": {
    "compression_threshold_tokens": 80000,
    "max_scratchpad_entries": 10,
    "auto_summarize_completed": true,
    "preserve_error_history": 5,
    "checkpoint_retention": 10
  },

  "model_selection": {
    "default": "sonnet",
    "by_task_complexity": {
      "simple": "haiku",
      "medium": "sonnet",
      "complex": "sonnet"
    },
    "by_phase": {
      "plan": "sonnet",
      "execute": "sonnet",
      "review": "sonnet",
      "learn": "haiku"
    },
    "cost_optimization": {
      "enabled": true,
      "prefer_haiku_for_simple": true
    }
  },

  "output": {
    "verbose": false,
    "show_reasoning": true,
    "show_phase_transitions": true,
    "show_task_progress": true,
    "show_verification_details": false,
    "show_learning_updates": true,
    "log_to_file": false,
    "log_path": ".apl/logs/"
  },

  "safety": {
    "require_confirmation_for_destructive": true,
    "max_files_per_task": 10,
    "max_lines_per_edit": 500,
    "blocked_paths": [
      "node_modules",
      ".git",
      ".env",
      ".env.*",
      "*.key",
      "*.pem",
      "*.secret",
      "credentials.*"
    ],
    "blocked_operations": [
      "rm -rf /",
      "DROP DATABASE",
      "format"
    ],
    "require_tests_before_commit": true,
    "require_tests_pass_for_task_completion": true,
    "block_on_test_regression": true
  },

  "domains": {
    "available": [
      "healthcare",
      "e-commerce",
      "saas",
      "fintech",
      "government",
      "ai-ml",
      "iot"
    ],
    "active": null,
    "questions_path": "templates/domain-questions/"
  },

  "meta_orchestrator": {
    "continuous_mode": {
      "enabled": true,
      "default_confidence_threshold": "low",
      "default_checkpoint_interval": 5,
      "default_pause_on_failure": true,
      "graceful_stop_file": ".meta/STOP",
      "state_file": ".meta/continuous-state.json"
    },
    "multi_repository": {
      "enabled": true,
      "workspace_root": null,
      "repositories": [],
      "cross_repo_tasks": true,
      "shared_state_path": ".meta/shared/",
      "dependency_graph": true,
      "parallel_repo_execution": true,
      "max_concurrent_repos": 3
    },
    "enterprise_workflow": {
      "require_adr_for_new_patterns": true,
      "security_scan_before_merge": true,
      "auto_generate_migration": true,
      "enforce_api_versioning": true,
      "generate_observability": true
    }
  },

  "integrations": {
    "vercel": {
      "enabled": true,
      "mcp_server": "vercel",
      "mcp_url": "https://mcp.vercel.com",
      "team_slug": null,
      "project_slug": null,
      "production_branch": "main",
      "preview_on_pr": true,
      "auto_deploy_after_review": false,
      "smoke_test_url": null
    },
    "pencil": {
      "enabled": true,
      "mcp_server": "pencil",
      "design_data_path": ".pencil/",
      "auto_export_on_change": true,
      "export_format": "tailwind",
      "design_before_code": true
    },
    "github": {
      "enabled": true,
      "auto_create_pr": false,
      "pr_template": "templates/pr-template.md"
    },
    "slack": {
      "enabled": false,
      "webhook_url": null,
      "notify_on_complete": false
    }
  }
}
