{
  "id": "sp_auth_bcrypt_001",
  "name": "Secure Password Hashing with bcrypt",
  "version": "1.0.0",
  "type": "success_pattern",

  "task_type": "authentication",
  "applicable_when": [
    "password hashing",
    "user password",
    "password storage",
    "hash password",
    "user registration",
    "secure password"
  ],

  "approach": "Use bcrypt with a cost factor of 10-12 for password hashing. Hash passwords asynchronously to avoid blocking. Never store plain text passwords. Use bcrypt.compare() for verification - never compare hashes directly.",

  "rationale": "bcrypt is specifically designed for password hashing with built-in salt and adaptive cost factor. Cost factor 10 provides good security while keeping hash time reasonable (~100ms). Async methods prevent blocking the event loop on Node.js.",

  "code_examples": {
    "user_model": "import bcrypt from 'bcrypt';\n\nconst SALT_ROUNDS = 10;\n\nexport interface IUser {\n  id: string;\n  email: string;\n  passwordHash: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport class User implements IUser {\n  id: string;\n  email: string;\n  passwordHash: string;\n  createdAt: Date;\n  updatedAt: Date;\n\n  static async hashPassword(plainPassword: string): Promise<string> {\n    return bcrypt.hash(plainPassword, SALT_ROUNDS);\n  }\n\n  async verifyPassword(plainPassword: string): Promise<boolean> {\n    return bcrypt.compare(plainPassword, this.passwordHash);\n  }\n}",

    "registration": "export async function registerUser(email: string, password: string) {\n  // Validate password strength first\n  if (password.length < 8) {\n    throw new Error('Password must be at least 8 characters');\n  }\n\n  // Hash password before storing\n  const passwordHash = await User.hashPassword(password);\n\n  // Create user with hash, never store plain password\n  const user = await User.create({\n    email,\n    passwordHash,\n    // password: password  // NEVER DO THIS\n  });\n\n  return user;\n}",

    "login": "export async function loginUser(email: string, password: string) {\n  const user = await User.findOne({ email });\n  if (!user) {\n    // Use same error for missing user and wrong password\n    // to prevent user enumeration\n    throw new AuthError('Invalid credentials');\n  }\n\n  const isValid = await user.verifyPassword(password);\n  if (!isValid) {\n    throw new AuthError('Invalid credentials');\n  }\n\n  return user;\n}"
  },

  "success_indicators": [
    "Passwords stored as bcrypt hashes (starting with $2a$ or $2b$)",
    "Cost factor is 10 or higher",
    "Using async hash/compare methods",
    "Same error message for invalid user and wrong password",
    "Password field never logged or returned in API responses"
  ],

  "anti_patterns_avoided": [
    "ap_security_plaintext_001",
    "ap_security_md5_sha1_001",
    "ap_security_sync_hash_001"
  ],

  "related_patterns": [
    "sp_auth_jwt_001",
    "sp_api_input_validation_001"
  ],

  "tags": ["security", "authentication", "password", "bcrypt", "hashing"],

  "metadata": {
    "author": "APL Starter Library",
    "created": "2024-01-15",
    "success_count": 0,
    "frameworks": ["express", "fastify", "nest"],
    "languages": ["typescript", "javascript"],
    "notes": "For pure-JS environments, use bcryptjs instead of bcrypt"
  }
}
